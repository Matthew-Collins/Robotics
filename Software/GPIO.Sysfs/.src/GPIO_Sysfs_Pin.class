' Gambas class file

Public Pin As Integer
Public Value As File

Public Sub _new(BCM_Pin_To_Export As Integer)
  Me.Pin = BCM_Pin_To_Export
  Shell "echo " & CStr(Me.Pin) & " > /sys/class/gpio/export" Wait
  Sleep 1
End

Public Sub SetDirection(Out As Boolean)
  Shell "echo " & If(Out, "out", "in") & " > /sys/class/gpio/gpio" & CStr(Me.pin) & "/direction" Wait
End

Public Sub SetValue(Value As Boolean)
  Shell "echo " & If(Value, "1", "0") & " > /sys/class/gpio/gpio" & CStr(Me.Pin) & "/value" Wait
End

Public Function GetValue() As Boolean
  Dim ReturnValue As String
  Shell "cat /sys/class/gpio/gpio" & CStr(Me.Pin) & "/value" Wait To ReturnValue
  Return CBool(Val(Replace(ReturnValue, "\n", "")))
End

Public Sub Listen()
  Me.Value = Open "/sys/class/gpio/gpio" & CStr(Me.Pin) & "/value" For Read Watch
End

Public Sub File_Read()
  Dim iByte As Byte
  Print CStr(Timer)
  While Not Eof(Me.Value)
    Read #Value, iByte
    Print "Got one byte: "; iByte
  Wend
End

Public Sub Close()
  Shell "echo " & CStr(Me.Pin) & " > /sys/class/gpio/unexport" Wait
End


