' Gambas class file

'Dependancy: i2c-Tools
'sudo apt-get install i2c-tools

Public Revison As Integer
Public Address As Integer 

Public Sub _new(Revison As Integer, Address As Integer)
  Me.Revison = Revison
  Me.Address = Address
End

Public Sub Detect()
  Shell "i2cdetect -y " & Me.Revison Wait
End

Public Sub Dump()
  Shell "i2cdump -y " & Me.Revison & " " & Me.Address Wait
End

Public Sub Write8(Register As Integer, Value As Integer)
  'TODO - Check
  Shell "i2cset -y " & Me.Revison & " " & Me.address & " " & register & " " & Value Wait
End

Public Function Read8(Register As Integer) As Integer
  Dim ReturnValue As String
  Shell "i2cget -y " & Me.Revison & " " & Me.address & " " & register Wait To ReturnValue
  Return HexStringToInteger(Returnvalue)
End

Public Function HexStringToInteger(Value As String) As Integer
  Return CInt(Val(Replace(Replace(Value, "0x", "&H"), "\n", "")))
End Function


